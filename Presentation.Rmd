---
title: "Morning Report"
author: "Austin Meyer"
date: "3/20/2019"
output: ioslides_presentation
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


## Initial Presentation

xx yo female with a h/o yy, zz. She had a recent episode of necrotizing fasciitis to the mons pubis for which she was hospitalized from xx to yy. She nows presentations with aa.

## Shiny Presentation

This R Markdown presentation is made interactive using Shiny. The viewers of the presentation can change the assumptions underlying what's presented and see the results immediately. 

To learn more, see [Interactive Documents](http://rmarkdown.rstudio.com/authoring_shiny.html).

## Probability of Pulmonary Embolism

```{r wells}
library(tibble)
library(ggplot2)
library(grid)

fluidPage(
  
  sidebarLayout(
    sidebarPanel(checkboxGroupInput("wells", label = tags$b("Wells Criteria"), 
                                    choices = list("Clinical signs or symptoms of DVT" = 3, 
                                                   "PE is #1 diagnosis" = 3, 
                                                   "Heart rate > 100" = 1.5,
                                                   "Immobilization >= 3 days or surgery in last 4 weeks" = 1.5, 
                                                   "Previous objective PE or DVT" = 1.5, 
                                                   "Hemoptysis" = 1,
                                                   "Cancer and treatment in last 6 months" = 1
                                    ),
                                    selected = 0),
                 hr(),
                 radioButtons("ddimer", label = tags$b("D-dimer > 500 µg/L"), 
                              choices = list('Yes' = 'positive', 'No' = 'negative'),
                              selected = 0),
                 width = 6
    ),
    
    mainPanel(plotOutput('probPlot'), 
              textOutput('probText'),  width = 6, align = 'right')
  )
)

output$probText <- renderText({
  points <- sum(as.numeric(input$wells))
  prob <- if(points < 3) 0.06 else if( points < 7 ) 0.23 else 0.49
  
  lr <- if(is.null(input$ddimer)) 1 else if(input$ddimer == 'positive') 0.91 / (1 - 0.6) else if(input$ddimer == 'negative') (1 - 0.91) / 0.6
  
  posttest.odds <- prob / (1 - prob) * lr
  posttest.prob <- round(posttest.odds / (1 + posttest.odds) * 100, 2)
  
  paste('Probability of PE = ', posttest.prob, '%', sep = '')
})

output$probPlot <- renderPlot({
  points <- sum(as.numeric(input$wells))
  prob <- if(points < 3) 0.06 else if( points < 7 ) 0.23 else 0.49
  
  lr <- if(is.null(input$ddimer)) 1 else if(input$ddimer == 'positive') 0.90 / (1 - 0.45) else if(input$ddimer == 'negative') (1 - 0.95) / 0.65
  
  posttest.odds <- prob / (1 - prob) * lr
  posttest.prob <- posttest.odds / (1 + posttest.odds)
  
  df <- tibble(x = c(' Pretest', 'Posttest'), y = c(prob, posttest.prob))
  
  p <- ggplot(df, aes(x = x, y = y)) + geom_bar(stat = 'identity') + 
    labs(x = '', y = '') +
    theme_classic() + 
    ylim(0,1) + 
    ylab('Fractional Probability') +
    theme(plot.margin = unit(c(0,0,-1,0), "lines"))
  gg2 <- ggplot_gtable(ggplot_build(p))
  gg2$layout$clip[gg2$layout$name == "panel"] <- "off"
  grid.draw(gg2)
})

```

<font size="1">Ceriani E, et al. Clinical prediction rules for pulmonary embolism: a systematic review and meta‐analysis. Journal of thrombosis and haemostasis. 2010 May;8(5):957-70.</font>
<font size="1">Crawford F, et al. D‐dimer test for excluding the diagnosis of pulmonary embolism. Cochrane Database of Systematic Reviews. 2016(8).</font>

## Bullets

- Bullet 1
- Bullet 2
- Bullet 3

## R Output

```{r cars}
summary(cars)
```


